# lambda local variables

lambda 局部变量

lambda允许使用“自由变量”（既不是参数而是在外部定义的变量），这一点和匿名函数一样。它们称为capturing lambdas。然而，有一个小的别扭：使用这些变量时有一些限制。Lambda没有任何限制地允许捕获实例变量和静态变量。但是局部变量需要显示地声明为final或者实际上是final。也就是说lambda表达式可以捕获只被赋值一次的变量（捕获一个实例变量可以视为捕获final 局部this）。下面的代码无法编译，因为portNumber被赋值两次：
```java
int portNumber = 1337;
Runnalbe r = () -> System.out.println(portNumber);
portNumber = 31337;
```

## 在局部变量上的限制
有两个原因使得局部变量由限制：
1. 是因为实例和局部变量的实现不同导致的。实例变量存在堆中，而局部变量存在栈中，如果一个lambda可以直接访问局部变量，并且lambda是在一个线程中使用，那么使用这个lambda的线程可以在这个变量被分配和释放之后访问这个变量。因此，Java实际上访问自由变量的方式是复制一份而不是直接访问原值。如果局部比那了仅仅赋值一次就没什么区别了。
2. 这一限制不鼓励使用改变外部变量的典型命令式编程模式，这种模式会阻碍并行处理。